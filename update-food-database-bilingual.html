<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Food Database (Bilingual)</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <h1 class="text-3xl font-bold text-purple-600 mb-6">ğŸ± Update Food Database (Hebrew + English)</h1>
        
        <div class="mb-6 space-y-2">
            <button onclick="updateDatabase()" class="bg-purple-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-600 transition">
                ğŸš€ Update Database with Bilingual Data
            </button>
            <button onclick="clearDatabase()" class="bg-red-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-600 transition ml-2">
                ğŸ—‘ï¸ Clear Old Data First
            </button>
            <p class="text-sm text-gray-600 mt-2">âš ï¸ Important: Click "Clear Old Data First" before updating to avoid duplicates</p>
        </div>
        
        <div id="status" class="bg-gray-50 p-4 rounded-lg border-2 border-gray-200 min-h-[400px] font-mono text-sm overflow-auto">
            <p class="text-gray-600">Ready to update database with bilingual food items...</p>
            <p class="text-gray-600">This will import 57 items with both English and Hebrew names from kids_breakfast_box_defaults_bilingual.csv</p>
        </div>
    </div>

    <script>
        // Bilingual CSV data parsed from kids_breakfast_box_defaults_bilingual.csv
        const bilingualFoodData = [
            // BASES / ×‘×¡×™×¡×™×
            {name: "Sliced bread", name_he: "×œ×—× ×¤×¨×•×¡", category: "grain", icon: "ğŸ", subcategory: "Bread", weekly_limit: 0, is_sweet: false},
            {name: "Mini roll", name_he: "×œ×—×× ×™×™×” ××™× ×™", category: "grain", icon: "ğŸ¥–", subcategory: "Bread", weekly_limit: 0, is_sweet: false},
            {name: "Tortilla", name_he: "×˜×•×¨×˜×™×™×”", category: "grain", icon: "ğŸŒ¯", subcategory: "Flatbread", weekly_limit: 0, is_sweet: false},
            {name: "Whole-grain crackers", name_he: "×§×¨×§×¨×™× ××œ××™×", category: "grain", icon: "ğŸ˜", subcategory: "Crackers", weekly_limit: 0, is_sweet: false},
            {name: "Mini bagel", name_he: "×‘×™×™×’×œ ××™× ×™", category: "grain", icon: "ğŸ¥¯", subcategory: "Bread", weekly_limit: 0, is_sweet: false},
            
            // PROTEINS / ×—×œ×‘×•×Ÿ
            {name: "Hard-boiled egg", name_he: "×‘×™×¦×” ×§×©×”", category: "protein", icon: "ğŸ¥š", subcategory: "Eggs", weekly_limit: 0, is_sweet: false},
            {name: "Egg omelette strips", name_he: "×¨×¦×•×¢×•×ª ×—×‘×™×ª×”", category: "protein", icon: "ğŸ³", subcategory: "Eggs", weekly_limit: 0, is_sweet: false},
            {name: "Turkey slices", name_he: "×¤×¨×•×¡×•×ª ×”×•×“×•", category: "protein", icon: "ğŸ¦ƒ", subcategory: "Poultry", weekly_limit: 3, is_sweet: false},
            {name: "Chicken schnitzel strips", name_he: "Chicken schnitzel strips", category: "protein", icon: "ğŸ—", subcategory: "Poultry", weekly_limit: 2, is_sweet: false},
            {name: "Roasted chickpeas", name_he: "Roasted chickpeas", category: "protein", icon: "ğŸ«˜", subcategory: "Legumes", weekly_limit: 0, is_sweet: false},
            {name: "Cheese slices", name_he: "×¤×¨×•×¡×•×ª ×’×‘×™× ×”", category: "dairy", icon: "ğŸ§€", subcategory: "Dairy", weekly_limit: 0, is_sweet: false},
            {name: "String cheese", name_he: "××§×œ ×’×‘×™× ×”", category: "dairy", icon: "ğŸ§€", subcategory: "Dairy", weekly_limit: 0, is_sweet: false},
            {name: "Cottage cheese", name_he: "×§×•×˜×’'", category: "dairy", icon: "ğŸ¥›", subcategory: "Dairy", weekly_limit: 0, is_sweet: false},
            {name: "Labneh", name_he: "×œ××‘× ×”", category: "dairy", icon: "ğŸ¥›", subcategory: "Dairy", weekly_limit: 0, is_sweet: false},
            {name: "Almond butter", name_he: "Almond butter", category: "protein", icon: "ğŸ¥œ", subcategory: "Nut butter", weekly_limit: 0, is_sweet: false},
            {name: "Sunflower seed butter", name_he: "×××¨×— ×’×¨×¢×™× ×™ ×—×× ×™×™×”", category: "protein", icon: "ğŸŒ»", subcategory: "Seed butter", weekly_limit: 0, is_sweet: false},
            
            // FRUITS / ×¤×™×¨×•×ª
            {name: "Apple slices", name_he: "×¤×œ×—×™ ×ª×¤×•×—", category: "fruit", icon: "ğŸ", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Banana", name_he: "×‘× × ×”", category: "fruit", icon: "ğŸŒ", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Grapes", name_he: "×¢× ×‘×™×", category: "fruit", icon: "ğŸ‡", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Clementine", name_he: "×§×œ×× ×˜×™× ×”", category: "fruit", icon: "ğŸŠ", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Pear slices", name_he: "×¤×œ×—×™ ××’×¡", category: "fruit", icon: "ğŸ", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Strawberries", name_he: "×ª×•×ª×™×", category: "fruit", icon: "ğŸ“", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Blueberries", name_he: "××•×›×× ×™×•×ª", category: "fruit", icon: "ğŸ«", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Melon cubes", name_he: "×§×•×‘×™×•×ª ××œ×•×Ÿ", category: "fruit", icon: "ğŸˆ", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Pineapple chunks", name_he: "×—×ª×™×›×•×ª ×× × ×¡", category: "fruit", icon: "ğŸ", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Dates (Medjool)", name_he: "Dates (Medjool)", category: "fruit", icon: "ğŸŸ«", subcategory: "Dried", weekly_limit: 2, is_sweet: true},
            
            // VEGGIES / ×™×¨×§×•×ª
            {name: "Cucumber sticks", name_he: "××§×œ×•×ª ××œ×¤×¤×•×Ÿ", category: "veggie", icon: "ğŸ¥’", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Cherry tomatoes", name_he: "×¢×’×‘× ×™×•×ª ×©×¨×™", category: "veggie", icon: "ğŸ…", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Carrot sticks", name_he: "××§×œ×•×ª ×’×–×¨", category: "veggie", icon: "ğŸ¥•", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Bell pepper strips", name_he: "×¨×¦×•×¢×•×ª ×¤×œ×¤×œ", category: "veggie", icon: "ğŸ«‘", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Sugar snap peas", name_he: "××¤×•× ×ª ×¡× ××¤", category: "veggie", icon: "ğŸ«›", subcategory: "Fresh", weekly_limit: 0, is_sweet: false},
            {name: "Olives (pitted)", name_he: "Olives (pitted)", category: "veggie", icon: "ğŸ«’", subcategory: "Pickled", weekly_limit: 0, is_sweet: false},
            {name: "Pickle spears", name_he: "××§×œ×•×ª ×—××•×¦×™×", category: "veggie", icon: "ğŸ¥’", subcategory: "Pickled", weekly_limit: 0, is_sweet: false},
            
            // DAIRY / ××•×¦×¨×™ ×—×œ×‘ (Yogurt)
            {name: "Plain yogurt cup", name_he: "×’×‘×™×¢ ×™×•×’×•×¨×˜ ×˜×‘×¢×™", category: "dairy", icon: "ğŸ¥›", subcategory: "Yogurt", weekly_limit: 0, is_sweet: false},
            {name: "Drinking yogurt", name_he: "Drinking yogurt", category: "dairy", icon: "ğŸ¥›", subcategory: "Yogurt", weekly_limit: 0, is_sweet: false},
            {name: "Kefir", name_he: "×§×¤×™×¨", category: "dairy", icon: "ğŸ¥›", subcategory: "Yogurt", weekly_limit: 0, is_sweet: false},
            
            // SPREADS / ×××¨×—×™×
            {name: "Avocado mash", name_he: "×××¨×— ××‘×•×§×“×•", category: "veggie", icon: "ğŸ¥‘", subcategory: "Spread", weekly_limit: 0, is_sweet: false},
            {name: "Cream cheese", name_he: "×’×‘×™× ×ª ×©×× ×ª", category: "dairy", icon: "ğŸ§ˆ", subcategory: "Spread", weekly_limit: 0, is_sweet: false},
            {name: "Honey drizzle", name_he: "Honey drizzle", category: "grain", icon: "ğŸ¯", subcategory: "Sweetener", weekly_limit: 2, is_sweet: true},
            {name: "Date spread (silan)", name_he: "Date spread (silan)", category: "grain", icon: "ğŸ¯", subcategory: "Sweetener", weekly_limit: 2, is_sweet: true},
            {name: "Butter", name_he: "×—×××”", category: "dairy", icon: "ğŸ§ˆ", subcategory: "Fat", weekly_limit: 0, is_sweet: false},
            
            // COMBOS / ×©×™×œ×•×‘×™×
            {name: "Bread + Yellow cheese + Tomato", name_he: "×œ×—× + ×’×‘×™× ×” ×¦×”×•×‘×” + ×¢×’×‘× ×™×™×”", category: "grain", icon: "ğŸ¥ª", subcategory: "Sandwich", weekly_limit: 0, is_sweet: false},
            {name: "Tortilla + Turkey + Lettuce", name_he: "×˜×•×¨×˜×™×™×” + Turkey + Lettuce", category: "grain", icon: "ğŸŒ¯", subcategory: "Wrap", weekly_limit: 3, is_sweet: false},
            {name: "Bagel + Cream cheese", name_he: "Bagel + ×’×‘×™× ×ª ×©×× ×ª", category: "grain", icon: "ğŸ¥¯", subcategory: "Sandwich", weekly_limit: 0, is_sweet: false},
            {name: "Bread + Avocado + Egg", name_he: "×œ×—× + ××‘×•×§×“×• + ×‘×™×¦×”", category: "grain", icon: "ğŸ¥ª", subcategory: "Sandwich", weekly_limit: 0, is_sweet: false},
            {name: "Pita + Labneh + Olive", name_he: "×¤×™×ª×” + ×œ××‘× ×” + Olive", category: "grain", icon: "ğŸ«“", subcategory: "Sandwich", weekly_limit: 0, is_sweet: false},
            {name: "Pita with za'atar (sesame)", name_he: "×¤×™×ª×” with za'atar (contains sesame)", category: "grain", icon: "ğŸ«“", subcategory: "Sandwich", weekly_limit: 0, is_sweet: false},
            {name: "Pita + olive oil + sumac", name_he: "×¤×™×ª×” + olive oil + sumac (no sesame)", category: "grain", icon: "ğŸ«“", subcategory: "Sandwich", weekly_limit: 0, is_sweet: false},
            
            // SNACKS / ×—×˜×™×¤×™×
            {name: "Plain pretzels", name_he: "×‘×™×™×’×œ×”", category: "snack", icon: "ğŸ¥¨", subcategory: "Baked", weekly_limit: 2, is_sweet: false},
            {name: "Air-popped popcorn", name_he: "×¤×•×¤×§×•×¨×Ÿ ×œ×œ× ×©××Ÿ", category: "snack", icon: "ğŸ¿", subcategory: "Baked", weekly_limit: 2, is_sweet: false},
            {name: "Granola bar", name_he: "Granola bar", category: "snack", icon: "ğŸ«", subcategory: "Packaged", weekly_limit: 2, is_sweet: true},
            {name: "Rice crackers (GF)", name_he: "Rice crackers (GF)", category: "snack", icon: "ğŸ˜", subcategory: "Crackers", weekly_limit: 2, is_sweet: false},
            
            // TREATS / ××ª×•×§×™×
            {name: "Mini homemade muffin", name_he: "×××¤×™×Ÿ ××™× ×™ ×‘×™×ª×™", category: "snack", icon: "ğŸ§", subcategory: "Baked", weekly_limit: 2, is_sweet: true},
            {name: "Dark chocolate square", name_he: "Dark chocolate square", category: "snack", icon: "ğŸ«", subcategory: "Chocolate", weekly_limit: 1, is_sweet: true},
            
            // DRINKS / ×©×ª×™×™×”
            {name: "Water", name_he: "××™×", category: "grain", icon: "ğŸ’§", subcategory: "Drink", weekly_limit: 0, is_sweet: false},
            {name: "Milk box", name_he: "×—×œ×‘ ×‘×§×•×¤×¡×”", category: "dairy", icon: "ğŸ¥›", subcategory: "Drink", weekly_limit: 0, is_sweet: false},
            {name: "100% fruit juice", name_he: "100% fruit juice", category: "fruit", icon: "ğŸ§ƒ", subcategory: "Drink", weekly_limit: 2, is_sweet: true},
        ];

        function log(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            statusDiv.innerHTML += `<p class="${colors[type]}">${message}</p>`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        async function clearDatabase() {
            if (!confirm('âš ï¸ This will DELETE all existing food items! Are you sure?')) {
                return;
            }
            
            log('ğŸ—‘ï¸ Starting database clear...', 'warning');
            
            try {
                // Get all existing food items
                const response = await fetch('tables/food_items?limit=200');
                const data = await response.json();
                
                if (!data.data || data.data.length === 0) {
                    log('âœ… No items to delete', 'success');
                    return;
                }
                
                log(`Found ${data.data.length} items to delete`, 'info');
                
                // Delete each item
                let deleted = 0;
                for (const item of data.data) {
                    try {
                        await fetch(`tables/food_items/${item.id}`, {
                            method: 'DELETE'
                        });
                        deleted++;
                        log(`Deleted: ${item.name} / ${item.name_he || 'N/A'} (${deleted}/${data.data.length})`, 'info');
                    } catch (e) {
                        log(`Error deleting ${item.name}: ${e.message}`, 'error');
                    }
                }
                
                log(`âœ… Cleared ${deleted} items from database`, 'success');
                
            } catch (error) {
                log(`âŒ Error clearing database: ${error.message}`, 'error');
            }
        }

        async function updateDatabase() {
            log('ğŸš€ Starting bilingual database update...', 'info');
            log(`ğŸ“Š Processing ${bilingualFoodData.length} food items (English + Hebrew)`, 'info');
            
            let added = 0;
            let errors = 0;
            
            for (const food of bilingualFoodData) {
                try {
                    const foodItem = {
                        name: food.name,
                        name_he: food.name_he,  // Hebrew name
                        category: food.category,
                        icon: food.icon,
                        ingredients: JSON.stringify([food.name.toLowerCase()]),
                        weekly_limit: food.weekly_limit || 0,
                        is_sweet: food.is_sweet || false,
                        nutrition_score: calculateNutritionScore(food)
                    };
                    
                    const response = await fetch('tables/food_items', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(foodItem)
                    });
                    
                    if (response.ok) {
                        added++;
                        log(`âœ… Added: ${food.name} / ${food.name_he} (${food.category}) [${added}/${bilingualFoodData.length}]`, 'success');
                    } else {
                        errors++;
                        const errorText = await response.text();
                        log(`âŒ Failed to add: ${food.name} - ${errorText}`, 'error');
                    }
                    
                    // Small delay to avoid overwhelming the API
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    errors++;
                    log(`âŒ Error adding ${food.name}: ${error.message}`, 'error');
                }
            }
            
            log('', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log(`ğŸ‰ Bilingual Database Update Complete!`, 'success');
            log(`âœ… Successfully added: ${added} items`, 'success');
            log(`âŒ Errors: ${errors} items`, errors > 0 ? 'error' : 'success');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('', 'info');
            log('ğŸ’¡ Next steps:', 'info');
            log('1. Refresh index.html to see bilingual food items', 'info');
            log('2. Toggle language (ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª / ğŸ‡ºğŸ‡¸ EN) to test Hebrew names', 'info');
            log('3. Check that all categories have items', 'info');
            log('4. Verify food names switch when changing language', 'info');
        }

        function calculateNutritionScore(food) {
            // Assign scores based on category and type
            const scores = {
                veggie: 5,
                fruit: 5,
                protein: 4,
                dairy: 4,
                grain: 3,
                snack: 2
            };
            
            let score = scores[food.category] || 3;
            
            // Reduce score for sweet items
            if (food.is_sweet) {
                score = Math.max(1, score - 1);
            }
            
            return score;
        }
    </script>
</body>
</html>
